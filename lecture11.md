# Лекция 11

## Функции

Хочется делать какую-то сложную функциональность, для этого есть функции, которые пишутся на отдельном языке внутри запроса.
Синтаксис простой. По большому счёту, дальше какое-то цитирование документации. А примеры коды большие, поэтому см. слайды

*Тут были слова про SQL инъекции. Мораль: надо чистить вход* -- это было в контексте динамического SQL.

Можем писать циклы, например, пройтись по строкам из какого-то SELECT.

В функциях можно создавать переменные с типом. Указываются в блоке DECLARE.
Переменные могут быть с типом ROWTYPE: её тип определяется во время парсинга.

### Сообщения и ошибки

И для того, и для другого нужен RAISE. Для конкретики надо задать уровень: DEBUG, LOG, INFO и т.д.
С помощью EXCEPTION можем перехватывать ошибки.

### Assert

Как в C. Вызывает исключение, если условие не выполняется. Нужно для отладки.

### IF-THEN

Как оно работает? Если выполняется условие, то выполнятся PREPARE statement --  объект живущий на сервере(можно делать свои), вызывается с помощью EXECUTE. Это код, который, предполагается, часто вызывается. Живут вов время сессии, но можно сбросить в ручную. 

### Циклы

Самый простой -- LOOP ... END LOOP

Но есть и нормальный цикл for прямиком из паскаля.

Кстати, переменные могут быть композитными, к полям можно обращаться в разных стилях: param(...) или .param

